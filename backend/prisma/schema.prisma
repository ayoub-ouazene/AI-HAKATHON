// Generator
generator client {
  provider = "prisma-client-js"
}

// Datasource
datasource db {
  provider = "postgresql"
}


// 2. Enums (The "Rules")
enum OfferType {
  EQUITY    // Selling shares (e.g., 10%)
  ROYALTY   // Sharing revenue (e.g., 5% of sales)
  DEBT      // Loan (Pay back with interest)
}

enum OfferStatus {
  PENDING         // Standard Deal (Investor accepted original terms)
  COUNTER_OFFER   // Investor changed price/equity
  ACCEPTED        // Startup accepted the deal
  REJECTED        // Startup declined the deal
}

enum MembershipModel {
  FIXED_FEE       // Startup paid cash upfront (15,000 DA)
  PLATFORM_EQUITY // Startup gave the platform shares (e.g. 1%)
}

enum RiskLevel {
  LOW
  MEDIUM
  HIGH
  EXTREME
}

// ==========================================
// TABLE 1: THE STARTUP
// (Contains Login + Profile + Verification)
// ==========================================

model Startup {
  id            Int      @id @default(autoincrement())
  
  // Auth
  email         String   @unique
  password      String
  
  // Step 1: Identity
  companyName   String
  founderName   String
  phone         String?
  websiteUrl    String?
  linkedinUrl   String?
  logoUrl       String?

  // --- NEW: Metrics & Founder Data ---
  sector              String?   // e.g. "Fintech"
  numFounders         Int       @default(1)
  hasTechnicalFounder Boolean   @default(false)
  experienceYears     Float     @default(0.0)
  monthlyUsers        Int       @default(0)
  // -----------------------------------

  // Step 2: Pitch Content
  description     String    @db.Text
  pitchDeckUrl    String?   
  videoPitchUrl   String?   

  // Step 3: Legal & Trust
  cnrcUrl         String?   
  isVerified      Boolean   @default(false) 
  
  // Step 4: Business Model
  membershipType      MembershipModel @default(FIXED_FEE)
  hasPaidFee          Boolean         @default(false) 
  platformEquityGiven Decimal?        @db.Decimal(5, 2)

  // Relations
  financials      FinancialRecord[]
  fundingRequests FundingRequest[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ==========================================
// TABLE 2: THE INVESTOR
// (Contains Login + Profile)
// ==========================================

model Investor {
  id        Int      @id @default(autoincrement())
  
  // Auth
  email     String   @unique
  password  String

  // Profile
  fullName      String
  biography     String?
  sectors       String[] // e.g. ["Fintech", "Health"]
  
  // Relations
  offersMade    InvestmentOffer[]
  postedOpportunities Opportunity[]
  
  createdAt DateTime @default(now())
}

// ==========================================
// TABLE 3: FINANCIAL DATA
// ==========================================

model FinancialRecord {
  id              Int      @id @default(autoincrement())
  
  // Link to Startup
  startupId       Int
  startup         Startup  @relation(fields: [startupId], references: [id])

  // Data
  month           DateTime // e.g. 2024-01-01
  revenue         Decimal  @db.Decimal(15, 2)
  costs           Decimal  @db.Decimal(15, 2)
  
  // Proof for AI (G50 or Bank Statement)
  // Optional: Because pre-revenue startups won't have it
  proofDocumentUrl String? 

  createdAt       DateTime @default(now())
}

// ==========================================
// TABLE 4: THE DEAL ENGINE
// ==========================================

model FundingRequest {
  id          Int      @id @default(autoincrement())
  startupId   Int
  startup     Startup  @relation(fields: [startupId], references: [id])

  // The Ask (What startup wants)
  amountRequested Decimal   @db.Decimal(15, 2)
  equityOffered   Decimal?  @db.Decimal(5, 2)
  offerType       OfferType @default(EQUITY)

  // AI Risk Analysis
  riskScore       Int?      
  riskLevel       RiskLevel?
  
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())

  // Relations
  waitingList     InvestmentOffer[]
}

model InvestmentOffer {
  id               Int            @id @default(autoincrement())

  // Link to Investor & Post
  investorId       Int
  investor         Investor       @relation(fields: [investorId], references: [id])
  
  fundingRequestId Int
  fundingRequest   FundingRequest @relation(fields: [fundingRequestId], references: [id])

  // Counter-Offer Logic (What investor actually offers)
  proposedAmount   Decimal        @db.Decimal(15, 2)
  proposedEquity   Decimal?       @db.Decimal(5, 2)
  
  status           OfferStatus    @default(PENDING)

  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt

  // Constraint: One active offer per investor per deal
  @@unique([investorId, fundingRequestId])
}

// ==========================================
// TABLE 5: REVERSE MARKET (Opportunities)
// ==========================================

model Opportunity {
  id          Int      @id @default(autoincrement())
  investorId  Int
  investor    Investor @relation(fields: [investorId], references: [id])

  title       String
  description String
  budget      Decimal?

  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
}